<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz ‚Äî PourquoiVoter.fr ¬∑ Paris 2026</title>
  <meta name="description" content="D√©couvrez quel candidat aux municipales de Paris 2026 correspond le mieux √† vos convictions." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #F7F6F2;
      --white: #FFFFFF;
      --ink: #111111;
      --ink-mid: #555555;
      --ink-light: #999999;
      --border: #E5E3DC;
      --navy: #0D1F3C;
      --accent: #FF4242;
      --green: #22863A;
      --shadow: 0 2px 12px rgba(0,0,0,0.07);
      --shadow-hover: 0 6px 24px rgba(0,0,0,0.12);
    }

    html, body {
      min-height: 100%;
      background: var(--bg);
      color: var(--ink);
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      line-height: 1.6;
    }

    /* HEADER */
    header {
      background: var(--navy);
      position: sticky;
      top: 0;
      z-index: 200;
    }

    .header-inner {
      max-width: 800px;
      margin: 0 auto;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo-main {
      font-family: 'DM Serif Display', serif;
      font-size: 20px;
      color: white;
      text-decoration: none;
    }

    .logo-accent { color: var(--accent); }

    .header-link {
      font-size: 13px;
      color: rgba(255,255,255,0.6);
      text-decoration: none;
      transition: color 0.15s;
    }

    .header-link:hover { color: white; }

    /* VIEWS */
    .view { display: none; }
    .view.active { display: block; }

    /* INTRO */
    #view-intro {
      max-width: 600px;
      margin: 0 auto;
      padding: 64px 24px;
      text-align: center;
    }

    .intro-tag {
      display: inline-block;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--accent);
      background: rgba(255,66,66,0.08);
      padding: 4px 12px;
      border-radius: 20px;
      margin-bottom: 20px;
    }

    .intro-title {
      font-family: 'DM Serif Display', serif;
      font-size: 42px;
      line-height: 1.15;
      color: var(--ink);
      margin-bottom: 16px;
    }

    .intro-sub {
      font-size: 17px;
      color: var(--ink-mid);
      margin-bottom: 40px;
      line-height: 1.6;
    }

    .intro-meta {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .intro-meta-item {
      font-size: 13px;
      color: var(--ink-light);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn-start {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 32px;
      padding: 16px 40px;
      font-family: 'DM Sans', sans-serif;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s;
    }

    .btn-start:hover { background: #e03333; transform: translateY(-2px); }

    .intro-disclaimer {
      margin-top: 24px;
      font-size: 12px;
      color: var(--ink-light);
    }

    /* QUIZ */
    #view-quiz {
      max-width: 700px;
      margin: 0 auto;
      padding: 32px 24px 80px;
    }

    .quiz-progress-bar {
      height: 4px;
      background: var(--border);
      border-radius: 4px;
      margin-bottom: 28px;
      overflow: hidden;
    }

    .quiz-progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 4px;
      transition: width 0.4s ease;
    }

    .quiz-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
    }

    .quiz-counter {
      font-size: 13px;
      font-weight: 600;
      color: var(--ink-light);
    }

    .quiz-theme {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent);
      background: rgba(255,66,66,0.08);
      padding: 3px 10px;
      border-radius: 20px;
    }

    .quiz-question {
      font-family: 'DM Serif Display', serif;
      font-size: 26px;
      line-height: 1.4;
      color: var(--ink);
      margin-bottom: 36px;
    }

    .quiz-answers {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }

    .answer-btn {
      background: var(--white);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 16px 20px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      font-weight: 500;
      color: var(--ink);
      cursor: pointer;
      text-align: left;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .answer-btn:hover:not(.selected) {
      border-color: var(--navy);
      background: #f0f0ec;
    }

    .answer-btn .answer-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
      background: var(--bg);
    }

    .answer-btn.selected-agree {
      border-color: #22863A;
      background: rgba(34,134,58,0.06);
      color: #22863A;
    }

    .answer-btn.selected-agree .answer-icon {
      background: #22863A;
      color: white;
    }

    .answer-btn.selected-neutral {
      border-color: var(--ink-light);
      background: rgba(0,0,0,0.04);
      color: var(--ink-mid);
    }

    .answer-btn.selected-neutral .answer-icon {
      background: var(--ink-light);
      color: white;
    }

    .answer-btn.selected-disagree {
      border-color: var(--accent);
      background: rgba(255,66,66,0.06);
      color: var(--accent);
    }

    .answer-btn.selected-disagree .answer-icon {
      background: var(--accent);
      color: white;
    }

    .priority-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 14px 16px;
      background: var(--white);
      border: 1.5px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.15s;
      margin-bottom: 28px;
      user-select: none;
    }

    .priority-wrap:hover { border-color: #F5A623; }

    .priority-wrap.active {
      border-color: #F5A623;
      background: #FFF8E7;
    }

    .priority-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.15s;
      font-size: 12px;
    }

    .priority-wrap.active .priority-checkbox {
      background: #F5A623;
      border-color: #F5A623;
      color: white;
    }

    .priority-label {
      font-size: 13.5px;
      color: var(--ink-mid);
    }

    .priority-wrap.active .priority-label { color: #5C4A1E; font-weight: 500; }

    .quiz-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .btn-prev {
      background: none;
      border: none;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      color: var(--ink-light);
      cursor: pointer;
      padding: 10px 0;
      transition: color 0.15s;
    }

    .btn-prev:hover { color: var(--ink); }
    .btn-prev:disabled { opacity: 0; pointer-events: none; }

    .btn-next {
      background: var(--navy);
      color: white;
      border: none;
      border-radius: 24px;
      padding: 12px 28px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-next:hover:not(:disabled) { background: #1a3560; transform: translateY(-1px); }
    .btn-next:disabled { background: var(--border); color: var(--ink-light); cursor: not-allowed; }

    /* RESULTS */
    #view-results {
      max-width: 700px;
      margin: 0 auto;
      padding: 48px 24px 80px;
    }

    .results-title {
      font-family: 'DM Serif Display', serif;
      font-size: 32px;
      color: var(--ink);
      margin-bottom: 8px;
    }

    .results-sub {
      font-size: 14px;
      color: var(--ink-light);
      margin-bottom: 36px;
    }

    .result-item {
      background: var(--white);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: var(--shadow);
      transition: transform 0.15s;
    }

    .result-item:hover { transform: translateY(-1px); }

    .result-rank {
      font-size: 22px;
      font-weight: 700;
      color: var(--ink-light);
      width: 36px;
      flex-shrink: 0;
      text-align: center;
    }

    .result-rank.top { color: var(--ink); }

    .result-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .result-info { flex: 1; min-width: 0; }

    .result-name {
      font-size: 15px;
      font-weight: 700;
      color: var(--ink);
    }

    .result-party {
      font-size: 12px;
      color: var(--ink-light);
    }

    .result-bar-wrap { flex: 1; min-width: 0; }

    .result-score-label {
      font-size: 13px;
      font-weight: 700;
      color: var(--ink-mid);
      text-align: right;
      margin-bottom: 4px;
    }

    .result-bar-track {
      height: 8px;
      background: var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .result-bar-fill {
      height: 100%;
      border-radius: 8px;
      transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .results-actions {
      margin-top: 32px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-restart {
      background: none;
      border: 2px solid var(--border);
      border-radius: 24px;
      padding: 11px 24px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      color: var(--ink-mid);
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-restart:hover { border-color: var(--ink); color: var(--ink); }

    .btn-chatbot {
      background: var(--navy);
      color: white;
      border: none;
      border-radius: 24px;
      padding: 13px 24px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.15s;
    }

    .btn-chatbot:hover { background: #1a3560; transform: translateY(-1px); }

    .results-disclaimer {
      margin-top: 24px;
      font-size: 12px;
      color: var(--ink-light);
      line-height: 1.6;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .result-item { animation: fadeUp 0.3s ease both; }

    @media (max-width: 600px) {
      .intro-title { font-size: 30px; }
      .quiz-question { font-size: 20px; }
      .result-bar-wrap { display: none; }
      .result-score-label { display: block; }
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <a href="/" class="logo-main">Pourquoi<span class="logo-accent">Voter</span>.fr</a>
    <a href="/" class="header-link">‚Üê Retour au chatbot</a>
  </div>
</header>

<!-- VUE INTRO -->
<div id="view-intro" class="view active">
  <span class="intro-tag">Paris 2026</span>
  <h1 class="intro-title">Quel candidat<br>vous correspond ?</h1>
  <p class="intro-sub">R√©pondez √† 18 affirmations sur les grands enjeux<br>de Paris pour d√©couvrir votre affinit√© avec chaque candidat.</p>
  <div class="intro-meta">
    <span class="intro-meta-item">üìã 18 affirmations</span>
    <span class="intro-meta-item">‚è± Environ 5 minutes</span>
    <span class="intro-meta-item">üîí Aucune donn√©e collect√©e</span>
  </div>
  <button class="btn-start" onclick="startQuiz()">Commencer le quiz ‚Üí</button>
  <p class="intro-disclaimer">Outil neutre ¬∑ Ne recommande aucun candidat ¬∑ Bas√© sur les programmes publi√©s</p>
</div>

<!-- VUE QUIZ -->
<div id="view-quiz" class="view">
  <div class="quiz-progress-bar">
    <div class="quiz-progress-fill" id="progress-fill"></div>
  </div>
  <div class="quiz-meta">
    <span class="quiz-counter" id="quiz-counter"></span>
    <span class="quiz-theme" id="quiz-theme"></span>
  </div>
  <p class="quiz-question" id="quiz-question"></p>
  <div class="quiz-answers" id="quiz-answers">
    <button class="answer-btn" id="btn-agree" onclick="selectAnswer(1)">
      <span class="answer-icon">‚úì</span>
      D'accord
    </button>
    <button class="answer-btn" id="btn-neutral" onclick="selectAnswer(0)">
      <span class="answer-icon">‚Äî</span>
      Neutre
    </button>
    <button class="answer-btn" id="btn-disagree" onclick="selectAnswer(-1)">
      <span class="answer-icon">‚úï</span>
      Pas d'accord
    </button>
  </div>
  <div class="priority-wrap" id="priority-wrap" onclick="togglePriority()">
    <div class="priority-checkbox" id="priority-checkbox"></div>
    <span class="priority-label">‚≠ê Ce sujet est important pour moi (poids √ó2)</span>
  </div>
  <div class="quiz-nav">
    <button class="btn-prev" id="btn-prev" onclick="goPrev()">‚Üê Pr√©c√©dent</button>
    <button class="btn-next" id="btn-next" onclick="goNext()" disabled>Suivant ‚Üí</button>
  </div>
</div>

<!-- VUE R√âSULTATS -->
<div id="view-results" class="view">
  <h2 class="results-title">Vos r√©sultats</h2>
  <p class="results-sub" id="results-sub"></p>
  <div id="results-list"></div>
  <div class="results-actions">
    <button class="btn-restart" onclick="restartQuiz()">‚Ü∫ Refaire le quiz</button>
    <a href="/" class="btn-chatbot">Explorer les programmes ‚Üí</a>
  </div>
  <p class="results-disclaimer">
    Ces r√©sultats refl√®tent l'affinit√© entre vos r√©ponses et les positions des candidats telles qu'elles apparaissent dans leurs programmes publi√©s. Ils ne constituent pas une recommandation de vote.
  </p>
</div>

<script>
// 1 = Pour, 0 = Neutre / Pas de position claire, -1 = Contre
const CANDIDATES = [
  { id: 'gregoire',  name: 'Emmanuel Gr√©goire', party: 'PS',          color: '#E91E8C' },
  { id: 'knafo',     name: 'Sarah Knafo',        party: 'Reconqu√™te',  color: '#1A237E' },
  { id: 'bournazel', name: 'P.-Y. Bournazel',    party: 'Renaissance', color: '#FF8C00' },
  { id: 'dati',      name: 'Rachida Dati',        party: 'LR',          color: '#0066CC' },
  { id: 'mariani',   name: 'Thierry Mariani',     party: 'RN',          color: '#003189' },
  { id: 'chikirou',  name: 'Sophia Chikirou',     party: 'LFI',         color: '#CC0000' },
];

const QUESTIONS = [
  { id: 1,  theme: 'Logement',         text: 'Paris doit construire davantage de logements sociaux dans tous les arrondissements.',                          positions: { gregoire: 1, knafo: -1, bournazel:  0, dati: -1, mariani: -1, chikirou:  1 } },
  { id: 2,  theme: 'Logement',         text: 'La mairie doit plafonner les loyers priv√©s √† Paris.',                                                          positions: { gregoire: 1, knafo: -1, bournazel:  0, dati: -1, mariani: -1, chikirou:  1 } },
  { id: 3,  theme: 'Logement',         text: 'Les locations de courte dur√©e (type Airbnb) doivent √™tre strictement limit√©es √† Paris.',                       positions: { gregoire: 1, knafo: -1, bournazel:  0, dati:  0, mariani: -1, chikirou:  1 } },
  { id: 4,  theme: 'S√©curit√©',         text: 'Paris doit renforcer sa police municipale avec davantage d\'agents dans les rues.',                            positions: { gregoire: 0, knafo:  1, bournazel:  1, dati:  1, mariani:  1, chikirou: -1 } },
  { id: 5,  theme: 'S√©curit√©',         text: 'La vid√©osurveillance doit √™tre √©tendue dans les rues et espaces publics de Paris.',                            positions: { gregoire: 0, knafo:  1, bournazel:  1, dati:  1, mariani:  1, chikirou: -1 } },
  { id: 6,  theme: 'Transports',       text: 'Paris doit r√©duire la place de la voiture en cr√©ant davantage de zones pi√©tonnes.',                           positions: { gregoire: 1, knafo: -1, bournazel:  0, dati: -1, mariani: -1, chikirou:  1 } },
  { id: 7,  theme: 'Transports',       text: 'Le d√©veloppement des pistes cyclables doit √™tre une priorit√© absolue de la prochaine mandature.',              positions: { gregoire: 1, knafo: -1, bournazel:  0, dati: -1, mariani: -1, chikirou:  1 } },
  { id: 8,  theme: 'Imp√¥ts & finances',text: 'La taxe fonci√®re doit √™tre r√©duite pour all√©ger la charge des propri√©taires parisiens.',                       positions: { gregoire:-1, knafo:  1, bournazel:  1, dati:  1, mariani:  1, chikirou: -1 } },
  { id: 9,  theme: 'Imp√¥ts & finances',text: 'Paris doit r√©duire ses d√©penses publiques pour assainir ses finances.',                                        positions: { gregoire:-1, knafo:  1, bournazel:  0, dati:  1, mariani:  1, chikirou: -1 } },
  { id: 10, theme: '√âcoles & cantines',text: 'Les cantines scolaires parisiennes doivent proposer des repas v√©g√©tariens plusieurs fois par semaine.',        positions: { gregoire: 1, knafo: -1, bournazel:  0, dati: -1, mariani: -1, chikirou:  1 } },
  { id: 11, theme: '√âcologie',         text: 'Paris doit planter massivement des arbres et v√©g√©taliser ses rues et toitures.',                               positions: { gregoire: 1, knafo:  0, bournazel:  1, dati:  0, mariani:  0, chikirou:  1 } },
  { id: 12, theme: 'Pauvret√© & SDF',   text: 'La mairie doit augmenter ses d√©penses pour l\'h√©bergement d\'urgence des personnes sans-abri.',                positions: { gregoire: 1, knafo:  0, bournazel:  0, dati:  0, mariani: -1, chikirou:  1 } },
  { id: 13, theme: 'Immigration',      text: 'Paris doit continuer √† accueillir et accompagner les migrants sur son territoire.',                             positions: { gregoire: 1, knafo: -1, bournazel:  0, dati: -1, mariani: -1, chikirou:  1 } },
  { id: 14, theme: 'Sant√©',            text: 'Paris doit financer des centres de sant√© municipaux gratuits dans chaque arrondissement.',                      positions: { gregoire: 1, knafo: -1, bournazel:  0, dati:  0, mariani: -1, chikirou:  1 } },
  { id: 15, theme: 'Culture & nuit',   text: 'La vie nocturne et les clubs parisiens doivent b√©n√©ficier d\'un soutien municipal renforc√©.',                  positions: { gregoire: 1, knafo: -1, bournazel:  1, dati:  0, mariani: -1, chikirou:  1 } },
  { id: 16, theme: '√âconomie',         text: 'Paris doit faciliter l\'implantation de nouvelles entreprises et commerces pour dynamiser l\'√©conomie.',       positions: { gregoire: 0, knafo:  1, bournazel:  1, dati:  1, mariani:  1, chikirou: -1 } },
  { id: 17, theme: 'D√©mocratie',       text: 'Les grands projets d\'am√©nagement de Paris doivent √™tre soumis au vote direct des Parisiens.',                 positions: { gregoire: 1, knafo:  0, bournazel:  1, dati:  0, mariani:  0, chikirou:  1 } },
  { id: 18, theme: 'Logement',         text: 'La mairie doit utiliser son droit de pr√©emption pour racheter des logements et les louer √† prix social.',      positions: { gregoire: 1, knafo: -1, bournazel:  0, dati: -1, mariani: -1, chikirou:  1 } },
];
</script>
<script>
  // STATE
  const state = {
    currentIndex: 0,
    answers: {}, // { questionId: { value: null|-1|0|1, priority: false } }
  };

  // INIT
  function startQuiz() {
    state.currentIndex = 0;
    state.answers = {};
    showView('view-quiz');
    renderQuestion(0);
  }

  function restartQuiz() {
    showView('view-intro');
  }

  function showView(id) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // RENDER QUESTION
  function renderQuestion(index) {
    const q = QUESTIONS[index];
    const answer = state.answers[q.id] || { value: null, priority: false };

    // Progress
    const progress = (index / QUESTIONS.length) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';

    // Meta
    document.getElementById('quiz-counter').textContent = `Question ${index + 1} / ${QUESTIONS.length}`;
    document.getElementById('quiz-theme').textContent = q.theme;
    document.getElementById('quiz-question').textContent = q.text;

    // Reset buttons
    const btnAgree    = document.getElementById('btn-agree');
    const btnNeutral  = document.getElementById('btn-neutral');
    const btnDisagree = document.getElementById('btn-disagree');

    btnAgree.className    = 'answer-btn';
    btnNeutral.className  = 'answer-btn';
    btnDisagree.className = 'answer-btn';

    if (answer.value === 1)  btnAgree.className    += ' selected-agree';
    if (answer.value === 0)  btnNeutral.className  += ' selected-neutral';
    if (answer.value === -1) btnDisagree.className += ' selected-disagree';

    // Priority
    const wrap = document.getElementById('priority-wrap');
    const box  = document.getElementById('priority-checkbox');
    if (answer.priority) {
      wrap.classList.add('active');
      box.textContent = '‚úì';
    } else {
      wrap.classList.remove('active');
      box.textContent = '';
    }

    // Navigation
    document.getElementById('btn-prev').disabled = (index === 0);
    document.getElementById('btn-next').disabled = (answer.value === null);
    document.getElementById('btn-next').textContent =
      (index === QUESTIONS.length - 1) ? 'Voir mes r√©sultats ‚Üí' : 'Suivant ‚Üí';
  }

  // INTERACTIONS
  function selectAnswer(value) {
    const q = QUESTIONS[state.currentIndex];
    if (!state.answers[q.id]) state.answers[q.id] = { value: null, priority: false };
    state.answers[q.id].value = value;
    renderQuestion(state.currentIndex);
  }

  function togglePriority() {
    const q = QUESTIONS[state.currentIndex];
    if (!state.answers[q.id]) state.answers[q.id] = { value: null, priority: false };
    state.answers[q.id].priority = !state.answers[q.id].priority;
    renderQuestion(state.currentIndex);
  }

  function goNext() {
    if (state.currentIndex < QUESTIONS.length - 1) {
      state.currentIndex++;
      renderQuestion(state.currentIndex);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    } else {
      showResults();
    }
  }

  function goPrev() {
    if (state.currentIndex > 0) {
      state.currentIndex--;
      renderQuestion(state.currentIndex);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

  // ALGORITHM
  function computeScores() {
    const scores = {};
    CANDIDATES.forEach(c => scores[c.id] = { points: 0, maxPoints: 0 });

    QUESTIONS.forEach(q => {
      const answer = state.answers[q.id];
      if (!answer || answer.value === null) return;

      const weight = answer.priority ? 2 : 1;

      CANDIDATES.forEach(c => {
        const candidatePos = q.positions[c.id]; // -1, 0, 1
        const userPos = answer.value;            // -1, 0, 1
        const diff = Math.abs(userPos - candidatePos); // 0, 1 ou 2
        const points = (2 - diff) * weight;
        scores[c.id].points += points;
        scores[c.id].maxPoints += 2 * weight;
      });
    });

    return CANDIDATES.map(c => ({
      ...c,
      score: scores[c.id].maxPoints > 0
        ? Math.round(scores[c.id].points / scores[c.id].maxPoints * 100)
        : 0,
    })).sort((a, b) => b.score - a.score);
  }

  // RESULTS
  function showResults() {
    const scores = computeScores();
    const answered = Object.values(state.answers).filter(a => a.value !== null).length;
    const prioritized = Object.values(state.answers).filter(a => a.priority).length;

    document.getElementById('results-sub').textContent =
      `Bas√© sur ${answered} r√©ponses${prioritized > 0 ? ` ¬∑ ${prioritized} sujet${prioritized > 1 ? 's' : ''} prioritaire${prioritized > 1 ? 's' : ''}` : ''}`;

    const list = document.getElementById('results-list');
    list.innerHTML = '';

    const medals = ['ü•á', 'ü•à', 'ü•â'];

    scores.forEach((c, i) => {
      const item = document.createElement('div');
      item.className = 'result-item';
      item.style.animationDelay = (i * 0.07) + 's';
      item.innerHTML = `
        <div class="result-rank ${i < 3 ? 'top' : ''}">${medals[i] || (i + 1)}</div>
        <div class="result-dot" style="background:${c.color}"></div>
        <div class="result-info">
          <div class="result-name">${c.name}</div>
          <div class="result-party">${c.party}</div>
        </div>
        <div class="result-bar-wrap">
          <div class="result-score-label">${c.score}%</div>
          <div class="result-bar-track">
            <div class="result-bar-fill" style="width:0%;background:${c.color}" data-pct="${c.score}"></div>
          </div>
        </div>
      `;
      list.appendChild(item);
    });

    showView('view-results');

    // Animate bars after render
    setTimeout(() => {
      list.querySelectorAll('.result-bar-fill').forEach(bar => {
        bar.style.width = bar.dataset.pct + '%';
      });
    }, 100);
  }
</script>
</body>
</html>
